<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>JAGD API Test Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .tab {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
      }

      .tab:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .tab.active {
        background: white;
        color: #667eea;
        border-color: white;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .card {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .card h2 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .card h3 {
        color: #555;
        margin-bottom: 10px;
        font-size: 1.2rem;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        font-weight: 500;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      input {
        padding: 10px 15px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        width: 300px;
        max-width: 100%;
      }

      input:focus {
        outline: none;
        border-color: #667eea;
      }

      .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .result {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-top: 15px;
        border-left: 4px solid #667eea;
        max-height: 600px;
        overflow-y: auto;
      }

      .result pre {
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        line-height: 1.5;
        color: #333;
      }

      .success {
        border-left-color: #10b981;
      }

      .error {
        border-left-color: #ef4444;
        background: #fee;
      }

      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-right: 10px;
      }

      .status-success {
        background: #d1fae5;
        color: #065f46;
      }

      .status-error {
        background: #fee2e2;
        color: #991b1b;
      }

      .info-box {
        background: #eff6ff;
        border: 1px solid #dbeafe;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
      }

      .info-box code {
        background: #dbeafe;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: monospace;
        color: #1e40af;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .endpoint-card {
        background: #f9fafb;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
      }

      .icon {
        font-size: 1.5rem;
      }

      .url-display {
        background: #1f2937;
        color: #10b981;
        padding: 10px 15px;
        border-radius: 6px;
        font-family: monospace;
        font-size: 0.9rem;
        margin: 10px 0;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîå JAGD API Test Dashboard</h1>
        <p>Test your Notion, GitHub, and LeetCode API endpoints</p>
      </div>

      <div class="tabs">
        <button
          class="tab active"
          onclick="switchTab('notion')"
        >
          üìì Notion API
        </button>
        <button
          class="tab"
          onclick="switchTab('github')"
        >
          üêô GitHub API
        </button>
        <button
          class="tab"
          onclick="switchTab('leetcode')"
        >
          üíª LeetCode API
        </button>
        <button
          class="tab"
          onclick="switchTab('info')"
        >
          ‚ÑπÔ∏è API Info
        </button>
      </div>

      <!-- Notion Tab -->
      <div
        id="notion-tab"
        class="tab-content active"
      >
        <div class="card">
          <h2><span class="icon">üìì</span> Notion API</h2>

          <div class="info-box">
            <strong>Base URL:</strong> <code>/api/notion</code><br />
            Test your Notion database integration for roadmap data.
          </div>

          <div class="grid">
            <div class="endpoint-card">
              <h3>üß™ Test Connection</h3>
              <p style="color: #666; margin: 10px 0">Verify Notion API connection</p>
              <div class="url-display">GET /api/notion/test</div>
              <button
                onclick="testNotion()"
                id="notionTestBtn"
              >
                Run Test
              </button>
            </div>

            <div class="endpoint-card">
              <h3>üìä Fetch Roadmap</h3>
              <p style="color: #666; margin: 10px 0">Get roadmap data for a project</p>
              <input
                type="text"
                id="notionProjectSlug"
                placeholder="Project slug (e.g., CodeLens)"
                value="CodeLens"
              />
              <div
                class="url-display"
                style="margin-top: 10px"
              >
                GET /api/notion/roadmap?projectSlug=...
              </div>
              <button
                onclick="fetchNotionRoadmap()"
                id="notionRoadmapBtn"
              >
                Fetch Roadmap
              </button>
            </div>
          </div>

          <div id="notionResult"></div>
        </div>
      </div>

      <!-- GitHub Tab -->
      <div
        id="github-tab"
        class="tab-content"
      >
        <div class="card">
          <h2><span class="icon">üêô</span> GitHub API</h2>

          <div class="info-box">
            <strong>Base URL:</strong> <code>/api/github</code><br />
            Test GitHub integration for contributions and commits.
          </div>

          <div class="grid">
            <div class="endpoint-card">
              <h3>üß™ Test Connection</h3>
              <p style="color: #666; margin: 10px 0">Verify GitHub API connection</p>
              <div class="url-display">GET /api/github/test</div>
              <button
                onclick="testGitHub()"
                id="githubTestBtn"
              >
                Run Test
              </button>
            </div>

            <div class="endpoint-card">
              <h3>üìà User Contributions</h3>
              <p style="color: #666; margin: 10px 0">All-time or specify months</p>
              <input
                type="text"
                id="githubUsername"
                placeholder="GitHub username"
                value="giuseppi"
                style="margin-bottom: 10px"
              />
              <input
                type="number"
                id="githubMonths"
                placeholder="Months (blank = all-time)"
                style="margin-bottom: 10px"
                min="1"
              />
              <div
                class="url-display"
                style="margin-top: 10px"
              >
                GET /api/github/contributions?username=...&months=...
              </div>
              <button
                onclick="fetchGitHubContributions()"
                id="githubContribBtn"
              >
                Fetch Contributions
              </button>
            </div>

            <div class="endpoint-card">
              <h3>üíæ Repository Commits</h3>
              <p style="color: #666; margin: 10px 0">ALL team commits (paginated)</p>
              <input
                type="text"
                id="githubRepo"
                placeholder="owner/repo"
                value="jagdteam/clicr"
              />
              <div
                class="url-display"
                style="margin-top: 10px"
              >
                GET /api/github/commits?repo=...
              </div>
              <p style="color: #999; font-size: 0.85rem; margin-top: 5px">‚ö†Ô∏è May take longer for large repos</p>
              <button
                onclick="fetchGitHubCommits()"
                id="githubCommitsBtn"
              >
                Fetch All Commits
              </button>
            </div>
          </div>

          <div id="githubResult"></div>
        </div>
      </div>

      <!-- LeetCode Tab -->
      <div
        id="leetcode-tab"
        class="tab-content"
      >
        <div class="card">
          <h2><span class="icon">üíª</span> LeetCode API</h2>

          <div class="info-box">
            <strong>Base URL:</strong> <code>/api/leetcode</code><br />
            Test LeetCode integration for user statistics.
          </div>

          <div class="grid">
            <div class="endpoint-card">
              <h3>üß™ Test Connection</h3>
              <p style="color: #666; margin: 10px 0">Verify LeetCode API connection</p>
              <div class="url-display">GET /api/leetcode/test</div>
              <button
                onclick="testLeetCode()"
                id="leetcodeTestBtn"
              >
                Run Test
              </button>
            </div>

            <div class="endpoint-card">
              <h3>üìä User Statistics</h3>
              <p style="color: #666; margin: 10px 0">Problems solved & submissions</p>
              <input
                type="text"
                id="leetcodeUsername"
                placeholder="LeetCode username"
                value="giuseppi"
              />
              <div
                class="url-display"
                style="margin-top: 10px"
              >
                GET /api/leetcode/stats?username=...
              </div>
              <button
                onclick="fetchLeetCodeStats()"
                id="leetcodeStatsBtn"
              >
                Fetch Stats
              </button>
            </div>
          </div>

          <div id="leetcodeResult"></div>
        </div>
      </div>

      <!-- Info Tab -->
      <div
        id="info-tab"
        class="tab-content"
      >
        <div class="card">
          <h2>‚ÑπÔ∏è API Information</h2>

          <h3 style="margin-top: 20px">üåê Base URLs</h3>
          <div class="info-box">
            <p><strong>Production:</strong> <code>https://jagdnotionapiserver.vercel.app</code></p>
            <p style="margin-top: 10px"><strong>Local Dev:</strong> <code>http://localhost:3000</code></p>
          </div>

          <h3 style="margin-top: 20px">üì° Available Endpoints</h3>

          <h4 style="margin-top: 15px; color: #667eea">Notion API</h4>
          <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8">
            <li><code>GET /api/notion/test</code> - Test connection</li>
            <li><code>GET /api/notion/roadmap?projectSlug=PROJECT</code> - Get project roadmap</li>
          </ul>

          <h4 style="margin-top: 15px; color: #667eea">GitHub API</h4>
          <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8">
            <li><code>GET /api/github/test</code> - Test connection</li>
            <li><code>GET /api/github/contributions?username=USER</code> - User contributions (5 months)</li>
            <li><code>GET /api/github/commits?repo=OWNER/REPO</code> - Repository commits (team filtered)</li>
          </ul>

          <h4 style="margin-top: 15px; color: #667eea">LeetCode API</h4>
          <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8">
            <li><code>GET /api/leetcode/test</code> - Test connection</li>
            <li><code>GET /api/leetcode/stats?username=USER</code> - User stats & submissions (5 months)</li>
          </ul>

          <h3 style="margin-top: 20px">‚ö° Features</h3>
          <div class="info-box">
            <ul style="margin-left: 20px; line-height: 1.8">
              <li>‚úÖ <strong>Caching:</strong> All endpoints cache until midnight PST</li>
              <li>‚úÖ <strong>CORS Enabled:</strong> Ready for frontend integration</li>
              <li>‚úÖ <strong>Standardized Responses:</strong> <code>{ success, data/error }</code> format</li>
              <li>‚úÖ <strong>Error Handling:</strong> Detailed error messages</li>
              <li>‚úÖ <strong>Personal Tokens:</strong> GitHub supports per-user tokens for private data</li>
              <li>‚úÖ <strong>Automatic Pagination:</strong> GitHub commits endpoint fetches ALL commits automatically</li>
              <li>‚úÖ <strong>Flexible Timeframes:</strong> Contributions support custom date ranges or all-time data</li>
            </ul>
          </div>

          <h3 style="margin-top: 20px">üîß Environment Variables</h3>
          <div class="info-box">
            <p><strong>Notion:</strong> NOTION_API_KEY, NOTION_CODELENS_DATABASE_ID</p>
            <p><strong>GitHub:</strong> GITHUB_API_TOKEN, [USERNAME]_GITHUB_TOKEN (optional)</p>
            <p><strong>LeetCode:</strong> No tokens required (public API)</p>
            <p style="margin-top: 10px; font-size: 0.9rem; color: #666">See <code>ENV_TEMPLATE.md</code> for detailed setup instructions.</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Use localhost for local testing, production URL for deployed version
      const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:3000' : 'https://jagdnotionapiserver.vercel.app';

      function switchTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach((tab) => {
          tab.classList.remove('active');
        });
        document.querySelectorAll('.tab').forEach((tab) => {
          tab.classList.remove('active');
        });

        // Show selected tab
        document.getElementById(`${tabName}-tab`).classList.add('active');
        event.target.classList.add('active');
      }

      function showLoading(buttonId) {
        const btn = document.getElementById(buttonId);
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span> Loading...';
      }

      function hideLoading(buttonId, text) {
        const btn = document.getElementById(buttonId);
        btn.disabled = false;
        btn.innerHTML = text;
      }

      function displayResult(elementId, data, isSuccess) {
        const element = document.getElementById(elementId);
        const statusClass = isSuccess ? 'success' : 'error';
        const statusBadge = isSuccess
          ? '<span class="status-badge status-success">‚úì Success</span>'
          : '<span class="status-badge status-error">‚úó Error</span>';

        element.innerHTML = `
                <div class="result ${statusClass}">
                    ${statusBadge}
                    <strong>${new Date().toLocaleTimeString()}</strong>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
      }

      // ========== NOTION API TESTS ==========

      async function testNotion() {
        showLoading('notionTestBtn');

        try {
          const response = await fetch(`${API_BASE}/api/notion/test`);
          const data = await response.json();

          displayResult('notionResult', data, data.success);
        } catch (error) {
          displayResult(
            'notionResult',
            {
              success: false,
              error: error.message,
            },
            false
          );
        } finally {
          hideLoading('notionTestBtn', 'Run Test');
        }
      }

      async function fetchNotionRoadmap() {
        showLoading('notionRoadmapBtn');
        const projectSlug = document.getElementById('notionProjectSlug').value;

        try {
          const url = projectSlug ? `${API_BASE}/api/notion/roadmap?projectSlug=${projectSlug}` : `${API_BASE}/api/notion/roadmap`;

          const response = await fetch(url);
          const data = await response.json();

          displayResult('notionResult', data, data.success);
        } catch (error) {
          displayResult(
            'notionResult',
            {
              success: false,
              error: error.message,
            },
            false
          );
        } finally {
          hideLoading('notionRoadmapBtn', 'Fetch Roadmap');
        }
      }

      // ========== GITHUB API TESTS ==========

      async function testGitHub() {
        showLoading('githubTestBtn');

        try {
          const response = await fetch(`${API_BASE}/api/github/test`);
          const data = await response.json();

          displayResult('githubResult', data, data.success);
        } catch (error) {
          displayResult(
            'githubResult',
            {
              success: false,
              error: error.message,
            },
            false
          );
        } finally {
          hideLoading('githubTestBtn', 'Run Test');
        }
      }

      async function fetchGitHubContributions() {
        showLoading('githubContribBtn');
        const username = document.getElementById('githubUsername').value;
        const months = document.getElementById('githubMonths').value;

        try {
          let url = `${API_BASE}/api/github/contributions?username=${username}`;
          if (months) {
            url += `&months=${months}`;
          }

          const response = await fetch(url);
          const data = await response.json();

          displayResult('githubResult', data, data.success);
        } catch (error) {
          displayResult(
            'githubResult',
            {
              success: false,
              error: error.message,
            },
            false
          );
        } finally {
          hideLoading('githubContribBtn', 'Fetch Contributions');
        }
      }

      async function fetchGitHubCommits() {
        showLoading('githubCommitsBtn');
        const repo = document.getElementById('githubRepo').value;

        try {
          const response = await fetch(`${API_BASE}/api/github/commits?repo=${repo}`);
          const data = await response.json();

          displayResult('githubResult', data, data.success);
        } catch (error) {
          displayResult(
            'githubResult',
            {
              success: false,
              error: error.message,
            },
            false
          );
        } finally {
          hideLoading('githubCommitsBtn', 'Fetch Commits');
        }
      }

      // ========== LEETCODE API TESTS ==========

      async function testLeetCode() {
        showLoading('leetcodeTestBtn');

        try {
          const response = await fetch(`${API_BASE}/api/leetcode/test`);
          const data = await response.json();

          displayResult('leetcodeResult', data, data.success);
        } catch (error) {
          displayResult(
            'leetcodeResult',
            {
              success: false,
              error: error.message,
            },
            false
          );
        } finally {
          hideLoading('leetcodeTestBtn', 'Run Test');
        }
      }

      async function fetchLeetCodeStats() {
        showLoading('leetcodeStatsBtn');
        const username = document.getElementById('leetcodeUsername').value;

        try {
          const response = await fetch(`${API_BASE}/api/leetcode/stats?username=${username}`);
          const data = await response.json();

          displayResult('leetcodeResult', data, data.success);
        } catch (error) {
          displayResult(
            'leetcodeResult',
            {
              success: false,
              error: error.message,
            },
            false
          );
        } finally {
          hideLoading('leetcodeStatsBtn', 'Fetch Stats');
        }
      }

      // Display API base URL on load
      console.log('üîå API Base URL:', API_BASE);
    </script>
  </body>
</html>
